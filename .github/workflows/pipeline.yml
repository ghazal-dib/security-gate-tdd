name: Security Gate TDD

on: [push, pull_request]

jobs:
  tests:
    runs-on: ubuntu-24.04
    steps:
        
      - name: Checkout repository
        uses: actions/checkout@v4
    
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: "pip"
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run tests
        run: pytest -q
  gate: 
    needs: tests
    runs-on: ubuntu-24.04
    steps:
        - name: Checkout repository
          uses: actions/checkout@v4
        
        - name: Set up Python
          uses: actions/setup-python@v5
          with:
            python-version: "3.12"
        
        - name: Run scanner
          run: python scanner.py
        
        - name: Upload scan result artifact
          if: always()
          uses: actions/upload-artifact@v4
          with:
            name: scan_result
            path: scan_result.json
        
        - name: Run security gate
          run: python gate.py
        - name: Upload gate decision artifact
          if: always()
          uses: actions/upload-artifact@v4
          with:
            name: gate_decision
            path: gate_decision.json
